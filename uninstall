# Copyright 2021 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
clear
source globals
OUTPUTFILE="uninstall.sh"

print_title "BASICLB UNINSTALL" "This process will delete all of the infrastructure you created with basiclb." "1"

BASENAME=basiclb
get_project_id PROJECT

handleProject PROJECT "$1"
computeRegionPicker REGION "$2" "COMPUTE"
computeZonePicker ZONE "$3" "$REGION"

projectDetails "
Project ID:,$PROJECT
Region:,$REGION
Zone:,$ZONE
"

section_open "Deleting Load Balancer"
    gcloud compute forwarding-rules delete $BASENAME-http-lb-forwarding-rule --global -q
    gcloud compute target-http-proxies delete $BASENAME-lb-proxy -q
    gcloud compute url-maps delete $BASENAME-lb -q
    gcloud compute backend-services delete $BASENAME-service --global -q
    gcloud compute health-checks delete $BASENAME-health-chk -q
    gcloud compute firewall-rules delete allow-health-check -q
section_close

section_open "Delete the IP Address"
    gcloud compute addresses delete $BASENAME-ip -q --global
section_close

section_open "Delete Managed Instance Group"
    gcloud compute instance-groups managed delete $BASENAME-mig --zone $ZONE -q
section_close

section_open "Delete Instance Template"
    gcloud compute instance-templates delete $BASENAME-template -q
section_close

section_open "Delete Disk Image"
    gcloud compute images delete $BASENAME-latest -q
section_close


# Let them know that it worked. 
printf "$DIVIDER"
printf "CONGRATS!!!!!!! \n"
printf "Everything is all cleaned up.\n"
printf "$DIVIDER"	
